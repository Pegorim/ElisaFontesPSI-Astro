---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const sortedPosts = posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout
  title="Blog | Elisa Fontes - Psicóloga em Niterói"
  description="Artigos sobre ansiedade, autoestima, autoconhecimento e saúde mental. Conteúdo escrito por Elisa Fontes, psicóloga clínica."
>
  <Header />

  <main class="bg-primary-bg px-6 md:px-12 lg:px-20 py-12">
    <!-- Blog Header -->
    <section class="max-w-6xl mx-auto mb-12">
      <h1 class="text-4xl md:text-5xl font-heading text-text-main mb-4 border-b border-text-main/30 pb-4">
        Blog
      </h1>
      <p class="text-text-main/70">
        Leia os posts do nosso blog
      </p>
    </section>

    <!-- Posts Grid -->
    <section class="max-w-6xl mx-auto">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {sortedPosts.map((post) => (
          <a
            href={`/blog/${post.id.replace(/\.md$/, '')}`}
            class="group bg-card-bg rounded-lg overflow-hidden hover:shadow-lg transition-shadow"
          >
            <!-- Post Image -->
            <div class="aspect-[4/3] overflow-hidden">
              {post.data.image ? (
                <img
                  src={post.data.image}
                  alt={post.data.title}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                />
              ) : (
                <div class="w-full h-full bg-card-bg flex items-center justify-center">
                  <span class="text-text-main/30 text-6xl">✦</span>
                </div>
              )}
            </div>

            <!-- Post Content -->
            <div class="p-4">
              <!-- Category Badge -->
              <span class="inline-block bg-primary-bg text-text-main text-xs font-medium px-3 py-1 rounded-sm mb-3">
                {post.data.category}
              </span>

              <!-- Title -->
              <h2 class="font-heading text-lg text-text-main group-hover:text-accent transition-colors line-clamp-2">
                {post.data.title}
              </h2>

              <!-- Description -->
              <p class="text-text-main/70 text-sm mt-2 line-clamp-2">
                {post.data.description}
              </p>
            </div>
          </a>
        ))}
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
